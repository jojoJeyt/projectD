!function(){if(window.WebSocket&&!window.replainInitialized){window.replainInitialized=!0;var e=null;window.__REPLAIN_&&(e=window.__REPLAIN_),window.replainSettings&&(e=window.replainSettings.id),null===e&&console.warn("Re:plain: Invalid widget code");var t=null;document.body?d():document.addEventListener("DOMContentLoaded",function(){d()})}function n(e){return JSON.stringify(e).replace(/,/g,";").replace(/"/g,"").slice(1,-1)}function i(){var e=window,t=document,n=t.documentElement,i=t.getElementsByTagName("body")[0];return{width:e.innerWidth||n.clientWidth||i.clientWidth,height:e.innerHeight||n.clientHeight||i.clientHeight}}function a(e,i,a,o){delete i.action;var r=i,d="100%"===r.height,l=navigator.userAgent.match(/(iPad|iPhone|iPod)/g);l&&d?(null===t&&(t=document.body.style.cssText),document.body.style.cssText=o):l&&!d&&null!==t&&(document.body.style.cssText=t),e.style.cssText=n(function(e,t){for(var n in t)e[n]=t[n];return e}(a,r))}function o(e,t){e.onclick=function(e){e.preventDefault(),window.ReplainAPI("open")};var n=t.content,i=e.getAttribute("data-title")||"";n=n.replace("{title}",i),i&&!i.length||e.classList.add("-replain-only-icon");var a=e.getAttribute("data-border");a&&("#"===a[0]?e.style.borderColor=a:e.classList.add("-replain-border-"+a));var o=e.getAttribute("data-color");o&&(e.style.color=o);var r=e.getAttribute("data-background");r&&(e.style.background=r),e.innerHTML=n}function r(e){var t,n,i,a=document.querySelectorAll(".replain-link");a.length&&(t=e.styles,n=function(){for(var t=0;t<a.length;t++)o(a[t],e)},(i=document.createElement("style")).type="text/css",i.id="replain-style",i.onload=n,i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)),document.getElementsByTagName("head")[0].appendChild(i));var r=document.querySelectorAll('a[href="#replain-link"]');if(r.length)for(var d=0;d<r.length;d++)r[d].onclick=function(e){e.preventDefault(),window.ReplainAPI("open")}}function d(){var t,o,d={position:"fixed",top:"auto",left:"auto",bottom:"20px",right:"20px",width:"70px",height:"70px","z-index":"2147483647",transform:"translate3d(0, 0, 0)","-webkit-transform":"translate3d(0, 0, 0)","background-color":"transparent"},l=new function(){var e=this;this.defaultTitle=document.title,this.timerId=null;var t=function(n,i){i++,document.title=i%2?n:this.defaultTitle,e.timerId=setTimeout(t.bind(e,n,i),1e3)};this.show=function(e){null===this.timerId&&(t(e,0),document.addEventListener("visibilitychange",this.hide))},this.hide=function(){document.hidden||(document.title=e.defaultTitle,clearTimeout(e.timerId),e.timerId=null,document.removeEventListener("visibilitychange",e.hide))}},c=(t=d,(o=document.createElement("div")).id="__replain_widget",o.style.cssText=n(t),o.innerHTML='<iframe id="__replain_widget_iframe" title="Re:plain" name="replain-frame" src="https://widget.replain.cc/dist/index.html?1560221339729" scrolling="no" frameBorder="0" allowfullscreen="" style="display:block !important; visibility:visible !important; background:none transparent !important; opacity:1 !important; overflow:visible !important; position:absolute !important; left:0 !important; top:0 !important; width:100% !important; min-width:auto !important; max-width:100vw !important; height:100% !important; min-height:auto !important; max-height:100% !important; z-index:2147483647 !important; transition:none !important;"></iframe>',document.body.appendChild(o),o),s=document.getElementById("__replain_widget_iframe");window.addEventListener("storage",function(e){0===e.key.indexOf("REPLAIN_")&&s.contentWindow.postMessage(JSON.stringify({cmd:"updateCache",data:e.newValue}),"*")}),window.addEventListener("resize",function(){s.contentWindow.postMessage(JSON.stringify({cmd:"resize",data:i()}),"*")}),window.addEventListener("visibilitychange",function(){s.contentWindow.postMessage(JSON.stringify({cmd:"visibilityChanged",data:document.hidden}),"*")}),window.ReplainAPI=function(e,t){s.contentWindow.postMessage(JSON.stringify({cmd:"api",data:{method:e,params:t}}),"*")},window.addEventListener("message",function(t){if(-1!==t.origin.indexOf("https://widget.replain.cc")){try{var n=JSON.parse(t.data)}catch(e){console.log("Re:plain: Skip event from",t.origin,t.data)}if(n)switch(n.cmd){case"created":s.contentWindow.postMessage(JSON.stringify({cmd:"init",data:{chatId:e,clientInfo:{language:document.getElementsByTagName("html")[0].getAttribute("lang"),windowSize:i(),currentUrl:location.href,auth:(localStorage.hasOwnProperty("REPLAIN_AUTH")?JSON.parse(localStorage.getItem("REPLAIN_AUTH")):JSON.parse(localStorage.getItem("REPLAIN_AUTH_"+e)))||{},cache:(localStorage.hasOwnProperty("REPLAIN_CACHE")?JSON.parse(localStorage.getItem("REPLAIN_CACHE")):JSON.parse(localStorage.getItem("REPLAIN_CACHE_"+e)))||{}},customButtons:null!==document.querySelector(".replain-link")||null!==document.querySelector('a[href="#replain-link"]')}}),"*");break;case"show-overlay-banners":!function(e){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://widget.replain.cc/dist/client/banners.js",t.onload=function(){window.ReplainInitBanners(e)};var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)}(s);break;case"storage-save":o=n.data.key,u=JSON.stringify(n.data.data),localStorage.setItem(o+"_"+e,u),localStorage.hasOwnProperty(o)&&localStorage.removeItem(o);break;case"widget-style":a(c,n.data,d,"position:fixed; left:0px; top:0px; width:100%; height:100%; margin: 0; padding: 0; overflow:hidden;");break;case"new-message":document.hidden&&l.show(n.data);break;case"log-event":!function(e,t){try{var n=window[window.GoogleAnalyticsObject||"ga"];"function"==typeof n&&("function"==typeof n.getAll?n.getAll()[0].send("event",e,t):n("send","event",e,t)),"object"==typeof _gaq&&"function"==typeof window._gaq.push&&window._gaq.push(["_trackEvent",e,t])}catch(e){console.warn("Replain: Error while trying to send event to Google Analytics:",e)}try{var i=window.Ya&&(window.Ya.Metrika||window.Ya.Metrika2);if("function"==typeof i&&"function"==typeof i.counters){var a=i.counters()[0].id;window["yaCounter"+a].reachGoal(e+"_"+t.replace(/\s/g,"_"))}}catch(e){console.warn("Replain: Error while trying to send event to Yandex.Metrika:",e)}}(n.data.category,n.data.action);break;case"show-custom-button":r(n.data)}}var o,u})}}();